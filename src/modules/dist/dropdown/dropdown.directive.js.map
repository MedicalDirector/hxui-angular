{"version":3,"file":"dropdown.directive.js","sourceRoot":"","sources":["../../dropdown/dropdown.directive.ts"],"names":[],"mappings":"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","sourcesContent":["import {\r\n  Directive, ElementRef, EmbeddedViewRef, EventEmitter, HostBinding, Input, OnDestroy, OnInit, Output,\r\n  Renderer, ViewContainerRef\r\n} from '@angular/core';\r\nimport { Subscription } from 'rxjs/Subscription';\r\nimport 'rxjs/add/operator/filter';\r\nimport { ComponentLoaderFactory } from '../component-loader/component-loader.factory';\r\nimport { ComponentLoader } from '../component-loader/component-loader.class';\r\nimport { DropdownConfig } from './dropdown.config';\r\nimport { DropdownContainerComponent } from './dropdown-container.component';\r\nimport { DropdownState } from './dropdown.state';\r\nimport { HxComponentRef } from '../component-loader/hx-component-ref.class';\r\nimport { DropdownMenuDirective } from './dropdown-menu.directive';\r\n\r\n@Directive({\r\n  selector: '[hxDropdown],[dropdown]',\r\n  exportAs: 'hx-dropdown',\r\n  providers: [DropdownState],\r\n  host: {\r\n    '[class.is-dropup]': 'dropup',\r\n    '[class.is-open]': 'isOpen',\r\n    '[class.is-right]': 'isRight'\r\n  }\r\n})\r\nexport class DropdownDirective implements OnInit, OnDestroy {\r\n  /**\r\n   * Placement of a popover. Accepts: \"top\", \"bottom\", \"left\", \"right\"\r\n   */\r\n  @Input() placement: string;\r\n  /**\r\n   * Specifies events that should trigger. Supports a space separated list of\r\n   * event names.\r\n   */\r\n  @Input() triggers: string;\r\n  /**\r\n   * A selector specifying the element the popover should be appended to.\r\n   * Currently only supports \"body\".\r\n   */\r\n  @Input() container: string;\r\n\r\n  /**\r\n   * This attribute indicates that the dropdown should be opened upwards\r\n   */\r\n  @Input() dropup: boolean;\r\n\r\n  /**\r\n   * Indicates that dropdown will be closed on item or document click,\r\n   * and after pressing ESC\r\n   */\r\n  @Input() set autoClose(value: boolean) {\r\n    if (typeof value === 'boolean') {\r\n      this._state.autoClose = value;\r\n    }\r\n  };\r\n\r\n  get autoClose(): boolean {\r\n    return this._state.autoClose;\r\n  }\r\n\r\n  /**\r\n   * Disables dropdown toggle and hides dropdown menu if opened\r\n   */\r\n  @Input() set isDisabled(value: boolean) {\r\n    this._isDisabled = value;\r\n    this._state.isDisabledChange.emit(value);\r\n    if (value) {\r\n      this.hide();\r\n    }\r\n  }\r\n\r\n  get isDisabled(): boolean { return this._isDisabled; }\r\n\r\n  /**\r\n   * Returns whether or not dropdown is position right of the toggle\r\n   */\r\n  @Input() get isRight(): boolean {\r\n    return this._isInlineRight;\r\n  }\r\n\r\n  set isRight(value: boolean) {\r\n    this._isInlineRight = value;\r\n  }\r\n\r\n  /**\r\n   * Returns whether or not the dropdown is currently being shown\r\n   */\r\n  @Input() get isOpen(): boolean {\r\n    if (this._showInline) {\r\n      return this._isInlineOpen;\r\n    }\r\n    return this._dropdown.isShown;\r\n  }\r\n\r\n  set isOpen(value: boolean) {\r\n    if (value) {\r\n      this.show();\r\n    } else {\r\n      this.hide();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Emits an event when isOpen change\r\n   */\r\n  @Output() isOpenChange: EventEmitter<any>;\r\n\r\n  /**\r\n   * Emits an event when the popover is shown\r\n   */\r\n  @Output() onShown: EventEmitter<any>;\r\n\r\n  /**\r\n   * Emits an event when the popover is hidden\r\n   */\r\n  @Output() onHidden: EventEmitter<any>;\r\n\r\n  // todo: move to component loader\r\n  private _isInlineOpen = false;\r\n  private _isInlineRight = false;\r\n  private _showInline: boolean;\r\n  private _inlinedMenu: EmbeddedViewRef<DropdownMenuDirective>;\r\n\r\n  private _isDisabled: boolean;\r\n  private _dropdown: ComponentLoader<DropdownContainerComponent>;\r\n  private _subscriptions: Subscription[] = [];\r\n  private _isInited = false;\r\n\r\n  constructor(private _elementRef: ElementRef,\r\n              private _renderer: Renderer,\r\n              private _viewContainerRef: ViewContainerRef,\r\n              private _cis: ComponentLoaderFactory,\r\n              private _config: DropdownConfig,\r\n              private _state: DropdownState) {\r\n    // create dropdown component loader\r\n    this._dropdown = this._cis\r\n      .createLoader<DropdownContainerComponent>(this._elementRef, this._viewContainerRef, this._renderer)\r\n      .provide({ provide: DropdownState, useValue: this._state });\r\n\r\n    this.onShown = this._dropdown.onShown;\r\n    this.onHidden = this._dropdown.onHidden;\r\n    this.isOpenChange = this._state.isOpenChange;\r\n\r\n    // set initial dropdown state from config\r\n    this._state.autoClose = this._config.autoClose;\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    // fix: seems there are an issue with `routerLinkActive`\r\n    // which result in duplicated call ngOnInit without call to ngOnDestroy\r\n    // read more: https://github.com/valor-software/ngx-bootstrap/issues/1885\r\n    if (this._isInited) { return; }\r\n    this._isInited = true;\r\n\r\n    this._showInline = !this.container;\r\n\r\n    // attach DOM listeners\r\n    this._dropdown.listen({\r\n      triggers: this.triggers,\r\n      show: () => this.show()\r\n    });\r\n\r\n    // toggle visibility on toggle element click\r\n    this._subscriptions.push(this._state\r\n      .toggleClick.subscribe((value: boolean) => this.toggle(value)));\r\n\r\n    // hide dropdown if set disabled while opened\r\n    this._subscriptions.push(this._state\r\n      .isDisabledChange\r\n      .filter((value: boolean) => value === true)\r\n      .subscribe((value: boolean) => this.hide()));\r\n\r\n    // attach dropdown menu inside of dropdown\r\n    if (this._showInline) {\r\n      this._state.dropdownMenu\r\n        .then((dropdownMenu: HxComponentRef<DropdownMenuDirective>) => {\r\n          this._inlinedMenu = dropdownMenu.viewContainer.createEmbeddedView(dropdownMenu.templateRef);\r\n        });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Opens an element’s popover. This is considered a “manual” triggering of\r\n   * the popover.\r\n   */\r\n  show(): void {\r\n    if (this.isOpen || this.isDisabled) {\r\n      return;\r\n    }\r\n\r\n    if (this._showInline) {\r\n      this._isInlineOpen = true;\r\n      this.onShown.emit(true);\r\n      this._state.isOpenChange.emit(true);\r\n      return;\r\n    }\r\n    this._state.dropdownMenu\r\n      .then((dropdownMenu) => {\r\n        // check direction in which dropdown should be opened\r\n        const _dropup = this.dropup === true ||\r\n          (typeof this.dropup !== 'undefined' && this.dropup !== false);\r\n        this._state.direction = _dropup ? 'up' : 'down';\r\n        const _placement = this.placement ||\r\n          (_dropup ? 'top left' : 'bottom left');\r\n\r\n        // show dropdown\r\n        this._dropdown\r\n          .attach(DropdownContainerComponent)\r\n          .to(this.container)\r\n          .position({ attachment: _placement })\r\n          .show({\r\n            content: dropdownMenu.templateRef,\r\n            placement: _placement\r\n          });\r\n\r\n        this._state.isOpenChange.emit(true);\r\n      });\r\n\r\n  }\r\n\r\n  /**\r\n   * Closes an element’s popover. This is considered a “manual” triggering of\r\n   * the popover.\r\n   */\r\n  hide(): void {\r\n    if (!this.isOpen) {\r\n      return;\r\n    }\r\n\r\n    if (this._showInline) {\r\n      this._isInlineOpen = false;\r\n      this.onHidden.emit(true);\r\n    } else {\r\n      this._dropdown.hide();\r\n    }\r\n\r\n    this._state.isOpenChange.emit(false);\r\n  }\r\n\r\n  /**\r\n   * Toggles an element’s popover. This is considered a “manual” triggering of\r\n   * the popover.\r\n   */\r\n  toggle(value?: boolean): void {\r\n    if (this.isOpen || value === false) {\r\n      return this.hide();\r\n    }\r\n\r\n    return this.show();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    // clean up subscriptions and destroy dropdown\r\n    for (const sub of this._subscriptions) {\r\n      sub.unsubscribe();\r\n    }\r\n    this._dropdown.dispose();\r\n  }\r\n}\r\n"]}