{"version":3,"file":"typeahead-container.component.js","sourceRoot":"","sources":["../../typeahead/typeahead-container.component.ts"],"names":[],"mappings":"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","sourcesContent":["import {\r\n  Component, ElementRef, TemplateRef, ViewEncapsulation, HostListener\r\n} from '@angular/core';\r\nimport { TypeaheadDirective } from './typeahead.directive';\r\nimport { TypeaheadMatch } from './typeahead-match.class';\r\nimport { latinize } from './typeahead-utils';\r\n\r\n@Component({\r\n  selector: 'hx-typeahead-container',\r\n  // tslint:disable-next-line\r\n  template: `\r\n<!-- inject options list template -->\r\n<ng-template [ngTemplateOutlet]=\"optionsListTemplate || optionListTemplate\"\r\n  [ngTemplateOutletContext]=\"{matches:matches, itemTemplate:itemTemplate, query:query}\"></ng-template>\r\n\r\n<!-- default options item template -->\r\n<ng-template #hxItemTemplate let-match=\"match\" let-query=\"query\"><span [innerHtml]=\"hightlight(match, query)\"></span></ng-template>\r\n\r\n<!-- options list template -->\r\n<ng-template #optionListTemplate >\r\n<ng-template ngFor let-match let-i=\"index\" [ngForOf]=\"matches\">\r\n   <h6 *ngIf=\"match.isHeader()\" class=\"hx-dropdown-header\">{{match}}</h6>\r\n   \r\n   <ng-template [ngIf]=\"!match.isHeader()\">\r\n      <a href=\"#\"\r\n        class=\"hx-dropdown-item\"\r\n        (click)=\"selectMatch(match, $event)\"\r\n        (mouseenter)=\"selectActive(match)\"\r\n        [class.active]=\"isActive(match)\">\r\n          <ng-template [ngTemplateOutlet]=\"itemTemplate || hxItemTemplate\" \r\n            [ngTemplateOutletContext]=\"{item:match.item, index:i, match:match, query:query}\"></ng-template>\r\n      </a>\r\n  </ng-template>\r\n</ng-template>\r\n</ng-template>\r\n`,\r\n  // tslint:disable\r\n  host: {\r\n    'class': 'hx-dropdown is-open hx-dropdown-menu',\r\n    style: 'position: absolute;display: block;'\r\n  },\r\n  // tslint: enable\r\n  encapsulation: ViewEncapsulation.None\r\n})\r\nexport class TypeaheadContainerComponent {\r\n  public parent: TypeaheadDirective;\r\n  public query: any;\r\n  public element: ElementRef;\r\n  public isFocused: boolean = false;\r\n  public top: string;\r\n  public left: string;\r\n  public display: string;\r\n  public placement: string;\r\n\r\n\r\n  protected _active: TypeaheadMatch;\r\n  protected _matches: TypeaheadMatch[] = [];\r\n\r\n  public constructor(element: ElementRef) {\r\n    this.element = element;\r\n  }\r\n\r\n  public get active(): TypeaheadMatch {\r\n    return this._active;\r\n  }\r\n\r\n  public get matches(): TypeaheadMatch[] {\r\n    return this._matches;\r\n  }\r\n\r\n  public set matches(value: TypeaheadMatch[]) {\r\n    this._matches = value;\r\n\r\n    if (this._matches.length > 0) {\r\n      this._active = this._matches[0];\r\n      if (this._active.isHeader()) {\r\n        this.nextActiveMatch();\r\n      }\r\n    }\r\n  }\r\n\r\n  public get optionsListTemplate(): TemplateRef<any> {\r\n    return this.parent ? this.parent.optionsListTemplate : undefined;\r\n  }\r\n\r\n  public get itemTemplate(): TemplateRef<any> {\r\n    return this.parent ? this.parent.typeaheadItemTemplate : undefined;\r\n  }\r\n\r\n  public selectActiveMatch(): void {\r\n    this.selectMatch(this._active);\r\n  }\r\n\r\n  public prevActiveMatch(): void {\r\n    let index = this.matches.indexOf(this._active);\r\n    this._active = this.matches[index - 1 < 0\r\n      ? this.matches.length - 1\r\n      : index - 1];\r\n    if (this._active.isHeader()) {\r\n      this.prevActiveMatch();\r\n    }\r\n\r\n  }\r\n\r\n  public nextActiveMatch(): void {\r\n    let index = this.matches.indexOf(this._active);\r\n    this._active = this.matches[index + 1 > this.matches.length - 1\r\n      ? 0\r\n      : index + 1];\r\n    if (this._active.isHeader()) {\r\n      this.nextActiveMatch();\r\n    }\r\n  }\r\n\r\n  public selectActive(value: TypeaheadMatch): void {\r\n    this.isFocused = true;\r\n    this._active = value;\r\n  }\r\n\r\n  public hightlight(match: TypeaheadMatch, query: any): string {\r\n    let itemStr: string = match.value;\r\n    let itemStrHelper: string = (this.parent && this.parent.typeaheadLatinize\r\n      ? latinize(itemStr)\r\n      : itemStr).toLowerCase();\r\n    let startIdx: number;\r\n    let tokenLen: number;\r\n    // Replaces the capture string with the same string inside of a \"strong\" tag\r\n    if (typeof query === 'object') {\r\n      let queryLen: number = query.length;\r\n      for (let i = 0; i < queryLen; i += 1) {\r\n        // query[i] is already latinized and lower case\r\n        startIdx = itemStrHelper.indexOf(query[i]);\r\n        tokenLen = query[i].length;\r\n        if (startIdx >= 0 && tokenLen > 0) {\r\n          itemStr = itemStr.substring(0, startIdx) + '<strong>' + itemStr.substring(startIdx, startIdx + tokenLen) + '</strong>' + itemStr.substring(startIdx + tokenLen);\r\n          itemStrHelper = itemStrHelper.substring(0, startIdx) + '        ' + ' '.repeat(tokenLen) + '         ' + itemStrHelper.substring(startIdx + tokenLen);\r\n        }\r\n      }\r\n    } else if (query) {\r\n      // query is already latinized and lower case\r\n      startIdx = itemStrHelper.indexOf(query);\r\n      tokenLen = query.length;\r\n      if (startIdx >= 0 && tokenLen > 0) {\r\n        itemStr = itemStr.substring(0, startIdx) + '<strong>' + itemStr.substring(startIdx, startIdx + tokenLen) + '</strong>' + itemStr.substring(startIdx + tokenLen);\r\n      }\r\n    }\r\n    return itemStr;\r\n  }\r\n\r\n  @HostListener('mouseleave')\r\n  @HostListener('blur')\r\n  public focusLost(): void {\r\n    this.isFocused = false;\r\n  }\r\n\r\n  public isActive(value: TypeaheadMatch): boolean {\r\n    return this._active === value;\r\n  }\r\n\r\n  public selectMatch(value: TypeaheadMatch, e: Event = void 0): boolean {\r\n    if (e) {\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n    }\r\n    this.parent.changeModel(value);\r\n    setTimeout(() =>\r\n      this.parent.typeaheadOnSelect.emit(value), 0\r\n    );\r\n    return false;\r\n  }\r\n}\r\n"]}